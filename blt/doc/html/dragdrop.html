<HTML><HEADER>
<!-- manual page source format generated by RosettaMan, -->
<!-- available via anonymous ftp from ftp.cs.berkeley.edu:/ucb/people/phelps/tcltk/rman.tar.Z -->
<TITLE>man page(1) manual page</TITLE>
</HEADER><BODY>
<A HREF="#toc">Table of Contents</A><P>
_________________________________________________________________<P>
<H2><A NAME="sect0" HREF="#toc0"><B>NAME</B></A></H2>
drag&amp;drop - facilities for handling drag&amp;drop data transfers<P>
<H2><A NAME="sect1" HREF="#toc1"><B>SYNOPSIS</B></A></H2>
<B>drag&amp;drop</B> <B>source</B><BR>
 <B>drag&amp;drop</B> <B>source</B> <I>window</I> ?<B>config</B> <I>options</I>? <B>drag&amp;drop</B> <B>source</B> <I>window</I> <B>handler</B> ?<I>dataType</I> <I>command</I> ...?<P>
<B>drag&amp;drop</B> <B>target</B><BR>
 <B>drag&amp;drop</B> <B>target</B> <I>window</I> <B>handler</B> ?<I>dataType</I> <I>command</I> ...?<P>
<B>drag&amp;drop</B> <B>target</B> <I>window</I> <B>handle</B> <I>dataType</I><P>
<B>drag&amp;drop</B> <B>drag</B> <I>window</I> <I>x</I> <I>y</I><BR>
 <B>drag&amp;drop</B> <B>drop</B> <I>window</I> <I>x</I> <I>y</I><BR>
 <B>drag&amp;drop</B> <B>active</B><BR>
 <B>drag&amp;drop</B> <B>errors</B> ?<I>proc</I>?<BR>
 <B>drag&amp;drop</B> <B>location</B> ?<I>x</I> <I>y</I>?<BR>
 _________________________________________________________________<P>
<H2><A NAME="sect2" HREF="#toc2"><B>DESCRIPTION</B></A></H2>
The <B>drag&amp;drop</B> command provides access to a set of facilities for managing drag-and-drop data transfers. Any of the usual Tk widgets can be registered to participate in the drag-and-drop process. Widgets registered as a drag&amp;drop <I>source</I> can export data to other widgets registered as a drag&amp;drop <I>target</I>. Note that a particular widget can be registered as a source, as a target, or as both.<P>
The drag-and-drop process begins when the user clicks and holds a mouse button in a source window; a token window appears with an icon or message to represent the data being transferred. As the user moves the mouse pointer, the token window follows along, acting as a movable packet of data. Whenever the mouse pointer falls on a valid target window, the border of the token window is changed to a raised (active) state. When the mouse button is released over the target window, a Tcl routine is invoked to send the data to the desired application. If this communication process fails, a rejection symbol (a circle with a line through it) is displayed on the token window to indicate failure.<P>
The details of the communication process are fully configurable by the application developer. The general philosophy, however, is that the sender should invoke a series of commands in the remote application to transfer data into a buffer, and then request that the receiver &quot;handle&quot; the data. For example, the sender might invoke a command like <B>&quot;set</B> <A HREF="http://localhost:6711/man?DragDrop?number">DragDrop(number)</A> 12.3&quot; in the target application. The sender would then request that the target &quot;handle&quot; a &quot;number". This separation between the data sent and the means of handling it is critical. It allows the developer a simple means of having several targets that all receive &quot;numbers&quot; but use them in different ways.<P>
Both sources and targets must be registered with a list of &quot;handlers&quot; defining the data types that they recognize. As a token window is dragged from its source to various targets, each target is checked to see if it recognizes a &quot;handler&quot; offered by the source. If it does, it is treated as a &quot;valid&quot; target. Otherwise, it is ignored. This scheme allows the same source to interact with many different kinds of targets. A source for RGB color samples, for instance, might have &quot;color&quot; and &quot;text&quot; handlers. This would allow it to communicate with &quot;color" targets (sending RGB data) as well as entry widgets (sending strings of the form &quot;#rrggbb").<P>
For drag&amp;drop to be effective across many applications, handlers for <I>sending</I> various data types should be common. For this reason, a directory &quot;demos/dd_protocols&quot; containing a number of example handlers is included with this distribution. Developers are encouraged to use this library and contribute new functions.<P>
This introduction was presented as a brief overview of the communication process; further details are presented below:<P>
<B>drag&amp;drop</B> <B>source</B><BR>
 Returns a list of path names for widgets registered as drag&amp;drop sources. Returns an empty string if no widgets have been registered.<P>
<B>drag&amp;drop</B> <B>source</B> <I>window</I> ?<B>config</B> <I>options</I>? Registers a new drag&amp;drop source window with the given options, or modifies the options for an existing window:<P>
<dl>
<dt>Name: <dd><B>buttonBinding</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>ButtonBinding</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-button</B> <I>n</I><P>
</dd>
</dl>
Specifies the mouse button (integer 1-5) that will invoke the drag&amp;drop operation on the source window. This causes the following bindings to be added to the widget:<P>
<B>bind</B> <I>win</I> <B>&lt;ButtonPress-n&gt;</B> <B>{drag&amp;drop</B> <B>drag</B> <B>%W</B> <B>%X</B> <B>%Y}</B> <B>bind</B> <I>win</I> <B>&lt;Bn-Motion&gt;</B> <B>{drag&amp;drop</B> <B>drag</B> <B>%W</B> <B>%X</B> <B>%Y}</B> <B>bind</B> <I>win</I> <B>&lt;ButtonRelease-n&gt;</B> <B>{drag&amp;drop</B> <B>drop</B> <B>%W</B> <B>%X</B> <B>%Y}</B><P>
The default value is button 3. If the value &quot;0&quot; is specified, then no bindings are added; this enables the user to establish bindings manually.<P>
<dl>
<dt>Name: <dd><B>packageCommand</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Command</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-packagecmd</B> <I>prefix</I><P>
</dd>
</dl>
Specifies a Tcl command used to establish the appearance of the token window at the start of each drag&amp;drop operation. This command is automatically invoked by the <B>drag&amp;drop</B> <B>drag</B> command whenever the token window is about to be mapped for a drag operation. The path name for the token window is automatically appended to the command before it is executed:<P>
<I>packagecmd</I> <I>token</I><P>
Typically, this command is the name of a procedure (taking the token window argument) which will pack a label--or update the text of a label--in the token window.<P>
The return value from the package command is later passed as an argument to the send handler; thus, it is the responsibility of the package command to determine what information will later be sent. For complex sources, such as a listbox containing a number of items, the package command can use the <B>drag&amp;drop</B> <B>location</B> command to determine the part of a widget that a user has selected and extract a value. For example, the following package routine will select an item from a listbox and configure the token window to display the selected string:<P>
<B>proc</B> <B>package_list_item</B> <B>{lbox</B> <B>token}</B> <B>{</B> <B>if</B> <B>{[winfo</B> <B>children</B> <B>$token]</B> <B>==</B> <B>&quot;"}</B> <B>{</B> <B>label</B> <B>$token.value</B><BR>
 <B>pack</B> <B>$token.value</B><BR>
 <B>}</B><BR>
 <B>set</B> <B>xy</B> <B>[drag&amp;drop</B> <B>location]</B> <B>set</B> <B>y</B> <B>[expr</B> <B>[lindex</B> <B>$xy</B> <B>1]-[winfo</B> <B>rooty</B> <B>$lbox]]</B><P>
<B>set</B> <B>str</B> <B>[$lbox</B> <B>get</B> <B>[$lbox</B> <B>nearest</B> <B>$y]]</B> <B>$token.value</B> <B>config</B> <B>-text</B> <B>$str</B> <B>return</B> <B>$str</B><BR>
 <B>}</B><P>
If the package command returns an empty string, the drag operation is quietly aborted. This can be used to disallow drag&amp;drop operations from certain parts of a widget, if the drag position is inappropriate.<P>
<dl>
<dt>Name: <dd><B>rejectBackground</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Background</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-rejectbg</B> <I>color</I><P>
</dd>
</dl>
Specifies the color used to draw the background of the rejection symbol on the token window. The rejection symbol (a circle with a line through it--the international &quot;no") appears whenever communication fails.<P>
<dl>
<dt>Name: <dd><B>rejectForeground</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Foreground</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-rejectfg</B> <I>color</I><P>
</dd>
</dl>
Specifies the color used to draw the foreground of the rejection symbol on the token window.<P>
<dl>
<dt>Name: <dd><B>rejectStipple</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Stipple</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-rejectstipple</B> <I>pattern</I><P>
</dd>
</dl>
Specifies a stipple pattern used to draw the foreground of the rejection symbol on the token window. Any of the forms acceptable to Tk_GetBitmap can be used.<P>
<dl>
<dt>Name: <dd><B>selfTarget</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>SelfTarget</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-selftarget</B> <I>boolean</I><P>
</dd>
</dl>
If the <I>boolean</I> value is true, and if a source widget is also registered as a compatible target, then the source will be able to transmit to itself during drag&amp;drop operations. This is primarily useful for complex sources such as a canvas widget, where items may be moved from place to place within the same widget. By default, this option is disabled.<P>
<dl>
<dt>Name: <dd><B>send</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Send</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-send</B> <I>list</I><P>
</dd>
</dl>
Specifies a <I>list</I> of <I>dataTypes</I> enabled for communication. Only <I>dataTypes</I> defined by commands of the form &quot;<B>drag&amp;drop</B> <B>source</B> <I>win</I><I>dow</I> <B>handler</B> ?<I>dataType</I> <I>command</I> ...?&quot; are allowed. This list also determines the priority of the various <I>dataTypes</I>. When a token window is over a potential drag&amp;drop target, this list is searched from start to finish for a <I>dataType</I> that is also recognized by the target. The first matching <I>dataType</I> found determines the value that will be sent if the token is dropped. If no matching <I>dataType</I> is found, then the target is incompatible, and is ignored.    By default, this option has the value &quot;all", indicating that all <I>dataTypes</I> should be considered in the order that they were defined for the source.<P>
Note that this option makes it easy to control a drag&amp;drop source. Setting the value to an empty string disables the source; setting the value back to &quot;all&quot; restores communication.<P>
<dl>
<dt>Name: <dd><B>siteCommand</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Command</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-sitecmd</B> <I>prefix</I><P>
</dd>
</dl>
Specifies a Tcl command used to update the appearance of the token window. If specified, this command is automatically invoked by the <B>drag&amp;drop</B> <B>drag</B> command whenever the token window is over a compatible drag&amp;drop target. Two arguments are appended to this command:<P>
<I>sitecmd</I> <I>state</I> <I>token</I><P>
<I>state</I> is an integer with a non-zero value whenever the token window is over a compatible target, and <I>token</I> is the path for the token window. Regardless of this command, border of the token window will become raised whenever the token is over a valid target. This command can be used to display other visual cues.<P>
<dl>
<dt>Name: <dd><B>tokenAnchor</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Anchor</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-tokenanchor</B> <I>anchor</I><P>
</dd>
</dl>
Specifies how the token window is positioned relative to the mouse pointer coordinates passed to the <B>drag&amp;drop</B> <B>drag</B> command. Must be one of the values n, s, e, w, center, nw, ne, sw or se. For example, &quot;nw&quot; means to position the token such that its upper-left corner is at the mouse pointer. The default value is &quot;center".<P>
<dl>
<dt>Name: <dd><B>tokenBackground</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Background</B><P>
</dd>
</dl>
<dl>
<dt>Switch: <dd><B>-tokenbg</B> <I>color</I><P>
</dd>
</dl>
Specifies the color used to draw the background of the token window.<P>
<dl>
<dt>Name: <dd><B>tokenBorderWidth</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>BorderWidth</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-tokenborderwidth</B> <I>size</I><P>
</dd>
</dl>
Specifies the width in pixels of the border around the token window.    This border becomes raised to indicate when the token is over a compatible drag&amp;drop target site. The value may have any of the forms acceptable to Tk_GetPixels. The default value is &quot;3".<P>
<dl>
<dt>Name: <dd><B>tokenCursor</B> </dd>
</dl>
<dl>
<dt>Class: <dd><B>Cursor</B> </dd>
</dl>
<dl>
<dt>Switch: <dd><B>-tokencursor</B> <I>cursor</I><P>
</dd>
</dl>
Specifies the cursor used when a token window is active. The value may have any of the forms acceptable to Tk_GetCursor. The default value is &quot;center_ptr".<P>
<B>drag&amp;drop</B> <B>source</B> <I>window</I> <B>handler</B> ?<I>dataType</I> <I>command</I> ...? Defines one or more <I>dataTypes</I> available for communication, and the <I>commands</I> used to send them to remote applications. If no <I>dataTypes</I> are specified, then the list of previously defined <I>dataTypes</I> is returned.<P>
Each <I>command</I> represents a Tcl command prefix. Three arguments are appended to this prefix when communication is initiated for a particular <I>dataType</I>:<P>
<I>command</I> <I>interp</I> <I>target</I> <I>data</I><P>
<I>interp</I> is the name of the interpreter containing the target widget; <I>target</I> is the name of the target widget; and <I>data</I> is the data string returned from the &quot;package&quot; command invoked at the start of the drag&amp;drop operation.<P>
A typical source handler contains one or more &quot;send&quot; commands which transfer data to the remote application, followed by a &quot;<B>drag&amp;drop</B> <B>widget</B> <B>handle</B> <B>the</B> <B>incoming</B> <B>data.</B> <B>An</B> <B>example</B> <B>source</B> <B>handler</B> <B>for</B> <B>a</B> <B>&quot;text&quot;</B> <B>data</B> <B>type</B> <B>is</B> <B>shown</B> <B>below:</B><P>
<B>proc</B> <B>dd_send_text</B> <B>{interp</B> <B>ddwin</B> <B>data}</B> <B>{</B> <B>send</B> <B>$interp</B> <B>&quot;</B><BR>
 <B>global</B> <B>DragDrop</B><BR>
 <B>set</B> <B>DragDrop(text)</B> <B>{$data}</B><P>
<B>&quot;</B><BR>
 <B>send</B> <B>$interp</B> <B>&quot;drag&amp;drop</B> <B>target</B> <B>$ddwin</B> <B>handle</B> <B>text"</B> <B>}</B><P>
This handler transfers the text string to a global variable DragDrop(text) in the target interpreter, and then requests that the target &quot;handle&quot; the incoming data. This separation between the transfer and the handling of the data is important. It allows the same source handler to transfer data for many different targets, and it allows each of the targets to handle the incoming data differently. If an error is encountered during the communication process, the rejection symbol is posted on the token window to indicate failure.<P>
<B>drag&amp;drop</B> <B>target</B><BR>
 Returns a list of path names for widgets registered as drag&amp;drop targets. Returns an empty string if no widgets have been registered.<P>
<B>drag&amp;drop</B> <B>target</B> <I>window</I> <B>handler</B> ?<I>dataType</I> <I>command</I> ...? Registers a new drag&amp;drop target window with the given handlers, or modifies the handlers for an existing window. If no handlers are specified, this command returns the current list of recognized <I>dataType</I> strings. Each <I>dataType</I> is a symbolic name representing a form of data, and the corresponding <I>command</I> is a Tcl command that specifies how the target will make use of the data. This command is invoked indirectly whenever a send routine transmits data and then issues the &quot;drag&amp;drop ... handle <I>dataType</I>&quot; command to make use of it.<P>
<B>drag&amp;drop</B> <B>target</B> <I>window</I> handle <I>dataType</I> Searches for the given <I>dataType</I> name among the handlers registered for the target <I>window</I>, and invokes the appropriate <I>command</I>. If the <I>dataType</I> name is not recognized, this command returns an error. Typically, this command is invoked by one of the send handlers for a drag&amp;drop source.<P>
<B>drag&amp;drop</B> <B>drag</B> <I>window</I> <I>x</I> <I>y</I><BR>
 Marks the start of (or movement during) a drag&amp;drop operation. If the token window is unmapped when this command is invoked, then the <B>-packagecmd</B> for the source <I>window</I> is executed. If this command is successful and returns a non-null string, the token window is mapped. On subsequent calls, the token window is moved to the new <I>x</I> <I>y</I> location. Unless the &quot;<B>-button</B> <B>0</B>&quot; option is specified for the source, this command is automatically bound to &lt;ButtonPress-<I>n</I>&gt; and &lt;B<I>n</I>-Motion&gt; events for &quot;<B>-button</B> <I>n</I>&quot; of the source widget.<P>
<B>drag&amp;drop</B> <B>drop</B> <I>window</I> <I>x</I> <I>y</I><BR>
 Marks the end of a drag&amp;drop operation. If the mouse pointer is over a compatible target window, then the appropriate send handler for the first compatible <I>dataType</I> is invoked to handle the data transfer. If the data transfer is successful, then the token window is unmapped; otherwise, a rejection symbol is drawn on the token window, and the window is unmapped after a small delay. Unless the &quot;<B>-button</B> <B>0</B>&quot; option is specified for the source, this command is automatically bound to the &lt;ButtonRelease-<I>n</I>&gt; event for &quot;<B>-button</B> <I>n</I>&quot; of the source widget.<P>
<B>drag&amp;drop</B> <B>active</B><BR>
 Returns &quot;1&quot; if a drag&amp;drop operation is in progress, and &quot;0&quot; otherwise. A drag&amp;drop operation officially starts after the package command has been executed successfully, and ends after the send handler has been executed (successfully or otherwise).<P>
<B>drag&amp;drop</B> <B>errors</B> ?<I>proc</I>?<BR>
 Specifies a Tcl <I>proc</I> used to handle errors encountered during drag&amp;drop operations. If a <I>proc</I> is not specified, this command returns the current error handler. By default, all errors are sent to the usual <B>tkerror</B> command, and therefore appear in a dialog box to the user. This behavior is quite useful when debugging communication protocols, but may not be desirable in a finished application. Errors can be suppressed entirely (leaving the rejection symbol as the only error indicator) by specifying a null string in place of the <I>proc</I> name.<P>
<B>drag&amp;drop</B> <B>location</B> ?<I>x</I> <I>y</I>?<BR>
 Used to set or query the pointer location during a drag&amp;drop operation. The <I>x</I> <I>y</I> arguments specify the current location; if these arguments are missing, then the last reported (x,y) location is returned as a list with two elements. This command is issued automatically within the <B>drag&amp;drop</B> <B>drag</B> and <B>drag&amp;drop</B> <B>drop</B> commands, to keep track of pointer movement.<P>
<H2><A NAME="sect3" HREF="#toc3"><B>KEYWORDS</B></A></H2>
drag&amp;drop, send, bind, widget<P>
<HR><P>
<A NAME="toc"><B>Table of Contents</B></A><P>
<UL>
<LI><A NAME="toc0" HREF="#sect0">NAME</A></LI>
<LI><A NAME="toc1" HREF="#sect1">SYNOPSIS</A></LI>
<LI><A NAME="toc2" HREF="#sect2">DESCRIPTION</A></LI>
<LI><A NAME="toc3" HREF="#sect3">KEYWORDS</A></LI>
</UL>
</BODY></HTML>
